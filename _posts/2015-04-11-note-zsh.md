---

layout: post
title: "NOTE : zsh"
date: 15-04-12 00:16:24
tags: [linux, note, shell, zsh]
categories: [code]

---

## Origin

> The name zsh derives from Yale professor Zhong Shao's (then a teaching assistant at Princeton University) name — Paul Falstad thought that Shao's login name, "zsh", was a good name for a shell.

<!-- more -->

## Configuration files

配置文件的讀取順序

```bash
/etc/zsh/zshenv
~/.zshenv
```

這兩個文件一般是設置一些環境變量，前者是 system-wide 的，後者則只針對當前用戶,通常這兩個文件已經設置一些變量，不應該命令

> it should not contain commands that produce output or assume the shell is attached to a tty.

```bash
/etc/zsh/zprofile
~/.zprofile
```

這兩個文件通常是在登錄 Shell 的時候執行相關的一些命令，前者是針對系統級別的，後者則針對當前用戶

```bash
/etc/zsh/zshrc
# Global configuration file, will be sourced when starting as a interactive shell.
~/.zshrc
# Main user configuration file, will be sourced when starting as a interactive shell.
```

> [**what do you mean by interactive shell?**]((http://unix.stackexchange.com/questions/43385/what-do-you-mean-by-interactive-shell))

> An interactive shell is simply any shell process that you use to type commands, and get back output from those commands. That is, a shell with which you interact.

> So, your login shell is interactive, as are any other shells you start manually, as described in the excerpt you quoted in your question. By contrast, when you run a shell script, a non-interactive shell is started that runs the commands in the script, and then exits when the script finishes.

>The Bourne shell can be used as an interactive shell, just like bash or tcsh. In fact, many systems, such as FreeBSD, use sh as the default user shell. Modern shells like bash, zsh, tcsh, etc have many features that Bourne shell doesn't have, that make them more comfortable and convenient for interactive use (command history, completion, etc).

>Interactive non-login shells (that is, shells you start manually from another shell or by opening a terminal window) don't read your .login or .profile files. These are only read and executed by login shells (shells started by the login system process, or by your X display manager), so the commands and settings they contain are only applied once, at the beginning of your login session. So, when you start a terminal, the shell that it spawns for you does not read your login files (.login for c-style shells, .profile for bourne style shells), but it does read the .cshrc, .bashrc etc files.

```bash
/etc/zsh/zlogin
# A global configuration file, will be sourced at the ending of initial progress when starting as a login shell.
~/.zlogin
# Same as /etc/zsh/zlogin but for per-user configuration.
/etc/zsh/zlogout
# A global configuration file, will be sourced when a login shell exits.
~/.zlogout
# Same as /etc/zsh/zlogout but for per-user configuration.
```

> [**Difference between Login Shell and Non-Login Shell?**](http://unix.stackexchange.com/questions/38175/difference-between-login-shell-and-non-login-shell) 

> A login shell is the first process that executes under your user ID when you log in for an interactive session. The login process tells the shell to behave as a login shell with a convention: passing argument 0, which is normally the name of the shell executable, with a - character prepended (e.g. -bash whereas it would normally be bash. Login shells typically read a file that does things like setting environment variables: /etc/profile and ~/.profile for the traditional Bourne shell, ~/.bash_profile additionally for bash†, /etc/zprofile and ~/.zprofile for zsh†, /etc/csh.login and ~/.login for csh, etc.

> When you log in on a text console, or through SSH, or with su -, you get an interactive login shell. When you log in in graphical mode (on an X display manager), you don't get a login shell, instead you get a session manager or a window manager.

> It's rare to run a non-interactive login shell, but some X settings do that when you log in with a display manager, so as to arrange to read the profile files. Other settings (this depends on the distribution and on the display manager) read /etc/profile and ~/.profile explicitly, or don't read them.

> When you start a shell in a terminal in an existing session (screen, X terminal, Emacs terminal buffer, a shell inside another, …), you get an interactive, non-login shell. That shell might read a shell configuration file (~/.bashrc for bash, /etc/zshrc and ~/.zshrc for zsh, /etc/csh.cshrc and ~/.cshrc for csh, etc.).

> When a shell runs a script or a command passed on its command line, it's a non-interactive, non-login shell. Such shells run all the time: it's very common that when a program calls another program, it really runs a tiny script in a shell to invoke that other program. Some shells read a startup file in this case (ksh and bash run the file indicated by the ENV variable, zsh runs /etc/zshenv and ~/.zshenv), but this is risky: the shell can be invoked in all sorts of contexts, and there's hardly anything you can do that might not break something.

## pkgfile

```bash
# 安裝 pkgfile
pacman -S pkgfile
# 更新 pkgfile
pkgfile --update
# add to shell
# ~/.bashrc
source /usr/share/doc/pkgfile/command-not-found.zsh
# ~/.zshrc
source /usr/share/doc/pkgfile/command-not-found.bash
```

安裝後解決的問題是，當你再使用某些命令時，如果整個命令不存在，pkgfile 會幫助你在 `official repositories` 裏面找相關的命令並提示你

e.g.

```bash
# 如果你沒有安裝 abiword，當你執行
abiword
# shell 會提醒如下文字
abiword may be found in the following packages:
  extra/abiword 2.8.6-7 usr/bin/abiword
```

## grml-zsh-config

**grml-zsh-config** 就是一系列，**zsh** 的配置文件

獲取配置文件 

```bash
# IMPORTANT: please note that you might override an existing
# configuration file in the current working directory! =>
wget -O .zshrc http://git.grml.org/f/grml-etc-core/etc/zsh/zshrc
# Optionally also grab the user configration:
wget -O .zshrc.local  http://git.grml.org/f/grml-etc-core/etc/skel/.zshrc
```

如果是 Arch 系統的話，可以通過安裝 `grml-zsh-config` 包來獲取配置文件，並且 `grml-zsh-config` 是 Arch 每月滾動更新中的默認配置文件。

安裝好後可以在 `/etc/zsh/zshrc` 中看到。

## zsh-syntax-highlighting 

```bash
pacman -S zsh-syntax-highlighting
```

輸入命令時有高亮提示，默認如果是無效命令則是紅色的，有效則是綠色。

## 設置

在 **Arch** 上，安裝 `grml-zsh-config` 後，會創建 `/etc/zsh/zshrc` 文件，所以安裝後就是全局的設置了，另外兩個配置文件則需要自行添加，如果想設置爲全局的，則將一下命令添加到 `/etc/zsh/zprofile` 中，如果只想在當前用戶下使用，則添加到 `~/.zshrc` 或者 `~/.zprofile` 中。

```bash
source /usr/share/doc/pkgfile/command-not-found.zsh
source /usr/share/zsh/plugins/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh
```

## Reference

- [Z shell - Wikipedia, the free encyclopedia](http://en.wikipedia.org/wiki/Z_shell)
- [Zsh - ArchWiki](https://wiki.archlinux.org/index.php/zsh)
- [pkgfile - ArchWiki](https://wiki.archlinux.org/index.php/Pkgfile)
- [grml.org - Zsh](http://grml.org/zsh/)